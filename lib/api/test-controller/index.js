'use strict';

exports.__esModule = true;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _set = require('babel-runtime/core-js/set');

var _set2 = _interopRequireDefault(_set);

var _pinkie = require('pinkie');

var _pinkie2 = _interopRequireDefault(_pinkie);

var _lodash = require('lodash');

var _getCallsite = require('../../errors/get-callsite');

var _clientFunctionBuilder = require('../../client-functions/client-function-builder');

var _clientFunctionBuilder2 = _interopRequireDefault(_clientFunctionBuilder);

var _assertion = require('./assertion');

var _assertion2 = _interopRequireDefault(_assertion);

var _delegatedApi = require('../../utils/delegated-api');

var _actions = require('../../test-run/commands/actions');

var _browserManipulation = require('../../test-run/commands/browser-manipulation');

var _observation = require('../../test-run/commands/observation');

var _assertType = require('../request-hooks/assert-type');

var _assertType2 = _interopRequireDefault(_assertType);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const originalThen = _pinkie2.default.resolve().then;

class TestController {
    constructor(testRun) {
        this.testRun = testRun;
        this.executionChain = _pinkie2.default.resolve();
        this.callsitesWithoutAwait = new _set2.default();
    }

    // NOTE: we track missing `awaits` by exposing a special custom Promise to user code.
    // Action or assertion is awaited if:
    // a)someone used `await` so Promise's `then` function executed
    // b)Promise chained by using one of the mixed-in controller methods
    //
    // In both scenarios, we check that callsite that produced Promise is equal to the one
    // that is currently missing await. This is required to workaround scenarios like this:
    //
    // var t2 = t.click('#btn1'); // <-- stores new callsiteWithoutAwait
    // await t2;                  // <-- callsiteWithoutAwait = null
    // t.click('#btn2');          // <-- stores new callsiteWithoutAwait
    // await t2.click('#btn3');   // <-- without check it will set callsiteWithoutAwait = null, so we will lost tracking
    _createExtendedPromise(promise, callsite) {
        const extendedPromise = promise.then(_lodash.identity);
        const markCallsiteAwaited = () => this.callsitesWithoutAwait.delete(callsite);

        extendedPromise.then = function () {
            markCallsiteAwaited();

            return originalThen.apply(this, arguments);
        };

        (0, _delegatedApi.delegateAPI)(extendedPromise, TestController.API_LIST, {
            handler: this,
            proxyMethod: markCallsiteAwaited
        });

        return extendedPromise;
    }

    _enqueueTask(apiMethodName, createTaskExecutor) {
        const callsite = (0, _getCallsite.getCallsiteForMethod)(apiMethodName);
        const executor = createTaskExecutor(callsite);

        this.executionChain.then = originalThen;
        this.executionChain = this.executionChain.then(executor);

        this.callsitesWithoutAwait.add(callsite);

        this.executionChain = this._createExtendedPromise(this.executionChain, callsite);

        return this.executionChain;
    }

    _enqueueCommand(apiMethodName, CmdCtor, cmdArgs) {
        var _this = this;

        return this._enqueueTask(apiMethodName, callsite => {
            let command = null;

            try {
                command = new CmdCtor(cmdArgs, this.testRun);
            } catch (err) {
                err.callsite = callsite;
                throw err;
            }

            if (this.testRun.recordScreenCapture && apiMethodName !== 'takeScreenshot') {
                return () => this.testRun.executeCommand(command, callsite).then((0, _asyncToGenerator3.default)(function* () {
                    if (_this.testRun.recordScreenCapture && apiMethodName !== 'takeScreenshot') {
                        const date = new Date();
                        const dateFolder = `${date.getMonth() + 1}_${date.getDate()}_${date.getFullYear()}`;
                        const sessionId = _this.testRun.session.id;
                        const testName = _this.testRun.test.name;
                        const path = `${dateFolder}/${sessionId}/${Date.now()}_${testName}_${apiMethodName}_auto.png`;

                        yield _this.testRun.executeCommand(new _browserManipulation.TakeScreenshotCommand({ path: path }));
                    }
                }));
            }

            return () => this.testRun.executeCommand(command, callsite);
        });
    }

    // API implementation
    // We need implementation methods to obtain correct callsites. If we use plain API
    // methods in chained wrappers then we will have callsite for the wrapped method
    // in this file instead of chained method callsite in user code.
    _ctx$getter() {
        return this.testRun.ctx;
    }

    _ctx$setter(val) {
        this.testRun.ctx = val;

        return this.testRun.ctx;
    }

    _fixtureCtx$getter() {
        return this.testRun.fixtureCtx;
    }

    _click$(selector, options) {
        return this._enqueueCommand('click', _actions.ClickCommand, { selector, options });
    }

    _rightClick$(selector, options) {
        return this._enqueueCommand('rightClick', _actions.RightClickCommand, { selector, options });
    }

    _doubleClick$(selector, options) {
        return this._enqueueCommand('doubleClick', _actions.DoubleClickCommand, { selector, options });
    }

    _hover$(selector, options) {
        return this._enqueueCommand('hover', _actions.HoverCommand, { selector, options });
    }

    _drag$(selector, dragOffsetX, dragOffsetY, options) {
        return this._enqueueCommand('drag', _actions.DragCommand, { selector, dragOffsetX, dragOffsetY, options });
    }

    _dragToElement$(selector, destinationSelector, options) {
        return this._enqueueCommand('dragToElement', _actions.DragToElementCommand, { selector, destinationSelector, options });
    }

    _typeText$(selector, text, options) {
        return this._enqueueCommand('typeText', _actions.TypeTextCommand, { selector, text, options });
    }

    _selectText$(selector, startPos, endPos, options) {
        return this._enqueueCommand('selectText', _actions.SelectTextCommand, { selector, startPos, endPos, options });
    }

    _selectTextAreaContent$(selector, startLine, startPos, endLine, endPos, options) {
        return this._enqueueCommand('selectTextAreaContent', _actions.SelectTextAreaContentCommand, {
            selector,
            startLine,
            startPos,
            endLine,
            endPos,
            options
        });
    }

    _selectEditableContent$(startSelector, endSelector, options) {
        return this._enqueueCommand('selectEditableContent', _actions.SelectEditableContentCommand, {
            startSelector,
            endSelector,
            options
        });
    }

    _pressKey$(keys, options) {
        return this._enqueueCommand('pressKey', _actions.PressKeyCommand, { keys, options });
    }

    _wait$(timeout) {
        return this._enqueueCommand('wait', _observation.WaitCommand, { timeout });
    }

    _navigateTo$(url) {
        return this._enqueueCommand('navigateTo', _actions.NavigateToCommand, { url });
    }

    _setFilesToUpload$(selector, filePath) {
        return this._enqueueCommand('setFilesToUpload', _actions.SetFilesToUploadCommand, { selector, filePath });
    }

    _clearUpload$(selector) {
        return this._enqueueCommand('clearUpload', _actions.ClearUploadCommand, { selector });
    }

    _takeScreenshot$(path) {
        return this._enqueueCommand('takeScreenshot', _browserManipulation.TakeScreenshotCommand, { path });
    }

    _takeElementScreenshot$(selector, ...args) {
        const commandArgs = { selector };

        if (args[1]) {
            commandArgs.path = args[0];
            commandArgs.options = args[1];
        } else if (typeof args[0] === 'object') commandArgs.options = args[0];else commandArgs.path = args[0];

        return this._enqueueCommand('takeElementScreenshot', _browserManipulation.TakeElementScreenshotCommand, commandArgs);
    }

    _resizeWindow$(width, height) {
        return this._enqueueCommand('resizeWindow', _browserManipulation.ResizeWindowCommand, { width, height });
    }

    _resizeWindowToFitDevice$(device, options) {
        return this._enqueueCommand('resizeWindowToFitDevice', _browserManipulation.ResizeWindowToFitDeviceCommand, { device, options });
    }

    _maximizeWindow$() {
        return this._enqueueCommand('maximizeWindow', _browserManipulation.MaximizeWindowCommand);
    }

    _switchToIframe$(selector) {
        return this._enqueueCommand('switchToIframe', _actions.SwitchToIframeCommand, { selector });
    }

    _switchToMainWindow$() {
        return this._enqueueCommand('switchToMainWindow', _actions.SwitchToMainWindowCommand);
    }

    _eval$(fn, options) {
        if (!(0, _lodash.isNil)(options)) options = (0, _lodash.assign)({}, options, { boundTestRun: this });

        const builder = new _clientFunctionBuilder2.default(fn, options, { instantiation: 'eval', execution: 'eval' });
        const clientFn = builder.getFunction();

        return clientFn();
    }

    _setNativeDialogHandler$(fn, options) {
        return this._enqueueCommand('setNativeDialogHandler', _actions.SetNativeDialogHandlerCommand, {
            dialogHandler: { fn, options }
        });
    }

    _getNativeDialogHistory$() {
        const callsite = (0, _getCallsite.getCallsiteForMethod)('getNativeDialogHistory');

        return this.testRun.executeCommand(new _actions.GetNativeDialogHistoryCommand(), callsite);
    }

    _getBrowserConsoleMessages$() {
        const callsite = (0, _getCallsite.getCallsiteForMethod)('getBrowserConsoleMessages');

        return this.testRun.executeCommand(new _actions.GetBrowserConsoleMessagesCommand(), callsite);
    }

    _expect$(actual) {
        const callsite = (0, _getCallsite.getCallsiteForMethod)('expect');

        return new _assertion2.default(actual, this, callsite);
    }

    _debug$() {
        return this._enqueueCommand('debug', _observation.DebugCommand);
    }

    _setTestSpeed$(speed) {
        return this._enqueueCommand('setTestSpeed', _actions.SetTestSpeedCommand, { speed });
    }

    _setPageLoadTimeout$(duration) {
        return this._enqueueCommand('setPageLoadTimeout', _actions.SetPageLoadTimeoutCommand, { duration });
    }

    _useRole$(role) {
        return this._enqueueCommand('useRole', _actions.UseRoleCommand, { role });
    }

    _addRequestHooks$(...hooks) {
        return this._enqueueTask('addRequestHooks', () => {
            hooks = (0, _lodash.flattenDeep)(hooks);

            (0, _assertType2.default)(hooks);

            hooks.forEach(hook => this.testRun.addRequestHook(hook));
        });
    }

    _removeRequestHooks$(...hooks) {
        return this._enqueueTask('removeRequestHooks', () => {
            hooks = (0, _lodash.flattenDeep)(hooks);

            (0, _assertType2.default)(hooks);

            hooks.forEach(hook => this.testRun.removeRequestHook(hook));
        });
    }
}

exports.default = TestController;
TestController.API_LIST = (0, _delegatedApi.getDelegatedAPIList)(TestController.prototype);

(0, _delegatedApi.delegateAPI)(TestController.prototype, TestController.API_LIST, { useCurrentCtxAsHandler: true });
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvdGVzdC1jb250cm9sbGVyL2luZGV4LmpzIl0sIm5hbWVzIjpbIm9yaWdpbmFsVGhlbiIsIlByb21pc2UiLCJyZXNvbHZlIiwidGhlbiIsIlRlc3RDb250cm9sbGVyIiwiY29uc3RydWN0b3IiLCJ0ZXN0UnVuIiwiZXhlY3V0aW9uQ2hhaW4iLCJjYWxsc2l0ZXNXaXRob3V0QXdhaXQiLCJfY3JlYXRlRXh0ZW5kZWRQcm9taXNlIiwicHJvbWlzZSIsImNhbGxzaXRlIiwiZXh0ZW5kZWRQcm9taXNlIiwiaWRlbnRpdHkiLCJtYXJrQ2FsbHNpdGVBd2FpdGVkIiwiZGVsZXRlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJBUElfTElTVCIsImhhbmRsZXIiLCJwcm94eU1ldGhvZCIsIl9lbnF1ZXVlVGFzayIsImFwaU1ldGhvZE5hbWUiLCJjcmVhdGVUYXNrRXhlY3V0b3IiLCJleGVjdXRvciIsImFkZCIsIl9lbnF1ZXVlQ29tbWFuZCIsIkNtZEN0b3IiLCJjbWRBcmdzIiwiY29tbWFuZCIsImVyciIsInJlY29yZFNjcmVlbkNhcHR1cmUiLCJleGVjdXRlQ29tbWFuZCIsImRhdGUiLCJEYXRlIiwiZGF0ZUZvbGRlciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImdldEZ1bGxZZWFyIiwic2Vzc2lvbklkIiwic2Vzc2lvbiIsImlkIiwidGVzdE5hbWUiLCJ0ZXN0IiwibmFtZSIsInBhdGgiLCJub3ciLCJUYWtlU2NyZWVuc2hvdENvbW1hbmQiLCJfY3R4JGdldHRlciIsImN0eCIsIl9jdHgkc2V0dGVyIiwidmFsIiwiX2ZpeHR1cmVDdHgkZ2V0dGVyIiwiZml4dHVyZUN0eCIsIl9jbGljayQiLCJzZWxlY3RvciIsIm9wdGlvbnMiLCJDbGlja0NvbW1hbmQiLCJfcmlnaHRDbGljayQiLCJSaWdodENsaWNrQ29tbWFuZCIsIl9kb3VibGVDbGljayQiLCJEb3VibGVDbGlja0NvbW1hbmQiLCJfaG92ZXIkIiwiSG92ZXJDb21tYW5kIiwiX2RyYWckIiwiZHJhZ09mZnNldFgiLCJkcmFnT2Zmc2V0WSIsIkRyYWdDb21tYW5kIiwiX2RyYWdUb0VsZW1lbnQkIiwiZGVzdGluYXRpb25TZWxlY3RvciIsIkRyYWdUb0VsZW1lbnRDb21tYW5kIiwiX3R5cGVUZXh0JCIsInRleHQiLCJUeXBlVGV4dENvbW1hbmQiLCJfc2VsZWN0VGV4dCQiLCJzdGFydFBvcyIsImVuZFBvcyIsIlNlbGVjdFRleHRDb21tYW5kIiwiX3NlbGVjdFRleHRBcmVhQ29udGVudCQiLCJzdGFydExpbmUiLCJlbmRMaW5lIiwiU2VsZWN0VGV4dEFyZWFDb250ZW50Q29tbWFuZCIsIl9zZWxlY3RFZGl0YWJsZUNvbnRlbnQkIiwic3RhcnRTZWxlY3RvciIsImVuZFNlbGVjdG9yIiwiU2VsZWN0RWRpdGFibGVDb250ZW50Q29tbWFuZCIsIl9wcmVzc0tleSQiLCJrZXlzIiwiUHJlc3NLZXlDb21tYW5kIiwiX3dhaXQkIiwidGltZW91dCIsIldhaXRDb21tYW5kIiwiX25hdmlnYXRlVG8kIiwidXJsIiwiTmF2aWdhdGVUb0NvbW1hbmQiLCJfc2V0RmlsZXNUb1VwbG9hZCQiLCJmaWxlUGF0aCIsIlNldEZpbGVzVG9VcGxvYWRDb21tYW5kIiwiX2NsZWFyVXBsb2FkJCIsIkNsZWFyVXBsb2FkQ29tbWFuZCIsIl90YWtlU2NyZWVuc2hvdCQiLCJfdGFrZUVsZW1lbnRTY3JlZW5zaG90JCIsImFyZ3MiLCJjb21tYW5kQXJncyIsIlRha2VFbGVtZW50U2NyZWVuc2hvdENvbW1hbmQiLCJfcmVzaXplV2luZG93JCIsIndpZHRoIiwiaGVpZ2h0IiwiUmVzaXplV2luZG93Q29tbWFuZCIsIl9yZXNpemVXaW5kb3dUb0ZpdERldmljZSQiLCJkZXZpY2UiLCJSZXNpemVXaW5kb3dUb0ZpdERldmljZUNvbW1hbmQiLCJfbWF4aW1pemVXaW5kb3ckIiwiTWF4aW1pemVXaW5kb3dDb21tYW5kIiwiX3N3aXRjaFRvSWZyYW1lJCIsIlN3aXRjaFRvSWZyYW1lQ29tbWFuZCIsIl9zd2l0Y2hUb01haW5XaW5kb3ckIiwiU3dpdGNoVG9NYWluV2luZG93Q29tbWFuZCIsIl9ldmFsJCIsImZuIiwiYm91bmRUZXN0UnVuIiwiYnVpbGRlciIsIkNsaWVudEZ1bmN0aW9uQnVpbGRlciIsImluc3RhbnRpYXRpb24iLCJleGVjdXRpb24iLCJjbGllbnRGbiIsImdldEZ1bmN0aW9uIiwiX3NldE5hdGl2ZURpYWxvZ0hhbmRsZXIkIiwiU2V0TmF0aXZlRGlhbG9nSGFuZGxlckNvbW1hbmQiLCJkaWFsb2dIYW5kbGVyIiwiX2dldE5hdGl2ZURpYWxvZ0hpc3RvcnkkIiwiR2V0TmF0aXZlRGlhbG9nSGlzdG9yeUNvbW1hbmQiLCJfZ2V0QnJvd3NlckNvbnNvbGVNZXNzYWdlcyQiLCJHZXRCcm93c2VyQ29uc29sZU1lc3NhZ2VzQ29tbWFuZCIsIl9leHBlY3QkIiwiYWN0dWFsIiwiQXNzZXJ0aW9uIiwiX2RlYnVnJCIsIkRlYnVnQ29tbWFuZCIsIl9zZXRUZXN0U3BlZWQkIiwic3BlZWQiLCJTZXRUZXN0U3BlZWRDb21tYW5kIiwiX3NldFBhZ2VMb2FkVGltZW91dCQiLCJkdXJhdGlvbiIsIlNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQiLCJfdXNlUm9sZSQiLCJyb2xlIiwiVXNlUm9sZUNvbW1hbmQiLCJfYWRkUmVxdWVzdEhvb2tzJCIsImhvb2tzIiwiZm9yRWFjaCIsImhvb2siLCJhZGRSZXF1ZXN0SG9vayIsIl9yZW1vdmVSZXF1ZXN0SG9va3MkIiwicmVtb3ZlUmVxdWVzdEhvb2siLCJwcm90b3R5cGUiLCJ1c2VDdXJyZW50Q3R4QXNIYW5kbGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7QUFFQTs7QUF5QkE7O0FBUUE7O0FBQ0E7Ozs7OztBQUVBLE1BQU1BLGVBQWVDLGlCQUFRQyxPQUFSLEdBQWtCQyxJQUF2Qzs7QUFFZSxNQUFNQyxjQUFOLENBQXFCO0FBQ2hDQyxnQkFBYUMsT0FBYixFQUFzQjtBQUNsQixhQUFLQSxPQUFMLEdBQTZC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a0JBQWZuSixjO0FBd1JyQkEsZUFBZWMsUUFBZixHQUEwQix1Q0FBb0JkLGVBQWV1SixTQUFuQyxDQUExQjs7QUFFQSwrQkFBWXZKLGVBQWV1SixTQUEzQixFQUFzQ3ZKLGVBQWVjLFFBQXJELEVBQStELEVBQUUwSSx3QkFBd0IsSUFBMUIsRUFBL0QiLCJmaWxlIjoiYXBpL3Rlc3QtY29udHJvbGxlci9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9taXNlIGZyb20gJ3BpbmtpZSc7XG5pbXBvcnQgeyBpZGVudGl0eSwgYXNzaWduLCBpc05pbCBhcyBpc051bGxPclVuZGVmaW5lZCwgZmxhdHRlbkRlZXAgYXMgZmxhdHRlbiB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBnZXRDYWxsc2l0ZUZvck1ldGhvZCB9IGZyb20gJy4uLy4uL2Vycm9ycy9nZXQtY2FsbHNpdGUnO1xuaW1wb3J0IENsaWVudEZ1bmN0aW9uQnVpbGRlciBmcm9tICcuLi8uLi9jbGllbnQtZnVuY3Rpb25zL2NsaWVudC1mdW5jdGlvbi1idWlsZGVyJztcbmltcG9ydCBBc3NlcnRpb24gZnJvbSAnLi9hc3NlcnRpb24nO1xuaW1wb3J0IHsgZ2V0RGVsZWdhdGVkQVBJTGlzdCwgZGVsZWdhdGVBUEkgfSBmcm9tICcuLi8uLi91dGlscy9kZWxlZ2F0ZWQtYXBpJztcblxuaW1wb3J0IHtcbiAgICBDbGlja0NvbW1hbmQsXG4gICAgUmlnaHRDbGlja0NvbW1hbmQsXG4gICAgRG91YmxlQ2xpY2tDb21tYW5kLFxuICAgIEhvdmVyQ29tbWFuZCxcbiAgICBEcmFnQ29tbWFuZCxcbiAgICBEcmFnVG9FbGVtZW50Q29tbWFuZCxcbiAgICBUeXBlVGV4dENvbW1hbmQsXG4gICAgU2VsZWN0VGV4dENvbW1hbmQsXG4gICAgU2VsZWN0VGV4dEFyZWFDb250ZW50Q29tbWFuZCxcbiAgICBTZWxlY3RFZGl0YWJsZUNvbnRlbnRDb21tYW5kLFxuICAgIFByZXNzS2V5Q29tbWFuZCxcbiAgICBOYXZpZ2F0ZVRvQ29tbWFuZCxcbiAgICBTZXRGaWxlc1RvVXBsb2FkQ29tbWFuZCxcbiAgICBDbGVhclVwbG9hZENvbW1hbmQsXG4gICAgU3dpdGNoVG9JZnJhbWVDb21tYW5kLFxuICAgIFN3aXRjaFRvTWFpbldpbmRvd0NvbW1hbmQsXG4gICAgU2V0TmF0aXZlRGlhbG9nSGFuZGxlckNvbW1hbmQsXG4gICAgR2V0TmF0aXZlRGlhbG9nSGlzdG9yeUNvbW1hbmQsXG4gICAgR2V0QnJvd3NlckNvbnNvbGVNZXNzYWdlc0NvbW1hbmQsXG4gICAgU2V0VGVzdFNwZWVkQ29tbWFuZCxcbiAgICBTZXRQYWdlTG9hZFRpbWVvdXRDb21tYW5kLFxuICAgIFVzZVJvbGVDb21tYW5kXG59IGZyb20gJy4uLy4uL3Rlc3QtcnVuL2NvbW1hbmRzL2FjdGlvbnMnO1xuXG5pbXBvcnQge1xuICAgIFRha2VTY3JlZW5zaG90Q29tbWFuZCxcbiAgICBUYWtlRWxlbWVudFNjcmVlbnNob3RDb21tYW5kLFxuICAgIFJlc2l6ZVdpbmRvd0NvbW1hbmQsXG4gICAgUmVzaXplV2luZG93VG9GaXREZXZpY2VDb21tYW5kLFxuICAgIE1heGltaXplV2luZG93Q29tbWFuZFxufSBmcm9tICcuLi8uLi90ZXN0LXJ1bi9jb21tYW5kcy9icm93c2VyLW1hbmlwdWxhdGlvbic7XG5cbmltcG9ydCB7IFdhaXRDb21tYW5kLCBEZWJ1Z0NvbW1hbmQgfSBmcm9tICcuLi8uLi90ZXN0LXJ1bi9jb21tYW5kcy9vYnNlcnZhdGlvbic7XG5pbXBvcnQgYXNzZXJ0UmVxdWVzdEhvb2tUeXBlIGZyb20gJy4uL3JlcXVlc3QtaG9va3MvYXNzZXJ0LXR5cGUnO1xuXG5jb25zdCBvcmlnaW5hbFRoZW4gPSBQcm9taXNlLnJlc29sdmUoKS50aGVuO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXN0Q29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IgKHRlc3RSdW4pIHtcbiAgICAgICAgdGhpcy50ZXN0UnVuICAgICAgICAgICAgICAgPSB0ZXN0UnVuO1xuICAgICAgICB0aGlzLmV4ZWN1dGlvbkNoYWluICAgICAgICA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB0aGlzLmNhbGxzaXRlc1dpdGhvdXRBd2FpdCA9IG5ldyBTZXQoKTtcbiAgICB9XG5cbiAgICAvLyBOT1RFOiB3ZSB0cmFjayBtaXNzaW5nIGBhd2FpdHNgIGJ5IGV4cG9zaW5nIGEgc3BlY2lhbCBjdXN0b20gUHJvbWlzZSB0byB1c2VyIGNvZGUuXG4gICAgLy8gQWN0aW9uIG9yIGFzc2VydGlvbiBpcyBhd2FpdGVkIGlmOlxuICAgIC8vIGEpc29tZW9uZSB1c2VkIGBhd2FpdGAgc28gUHJvbWlzZSdzIGB0aGVuYCBmdW5jdGlvbiBleGVjdXRlZFxuICAgIC8vIGIpUHJvbWlzZSBjaGFpbmVkIGJ5IHVzaW5nIG9uZSBvZiB0aGUgbWl4ZWQtaW4gY29udHJvbGxlciBtZXRob2RzXG4gICAgLy9cbiAgICAvLyBJbiBib3RoIHNjZW5hcmlvcywgd2UgY2hlY2sgdGhhdCBjYWxsc2l0ZSB0aGF0IHByb2R1Y2VkIFByb21pc2UgaXMgZXF1YWwgdG8gdGhlIG9uZVxuICAgIC8vIHRoYXQgaXMgY3VycmVudGx5IG1pc3NpbmcgYXdhaXQuIFRoaXMgaXMgcmVxdWlyZWQgdG8gd29ya2Fyb3VuZCBzY2VuYXJpb3MgbGlrZSB0aGlzOlxuICAgIC8vXG4gICAgLy8gdmFyIHQyID0gdC5jbGljaygnI2J0bjEnKTsgLy8gPC0tIHN0b3JlcyBuZXcgY2FsbHNpdGVXaXRob3V0QXdhaXRcbiAgICAvLyBhd2FpdCB0MjsgICAgICAgICAgICAgICAgICAvLyA8LS0gY2FsbHNpdGVXaXRob3V0QXdhaXQgPSBudWxsXG4gICAgLy8gdC5jbGljaygnI2J0bjInKTsgICAgICAgICAgLy8gPC0tIHN0b3JlcyBuZXcgY2FsbHNpdGVXaXRob3V0QXdhaXRcbiAgICAvLyBhd2FpdCB0Mi5jbGljaygnI2J0bjMnKTsgICAvLyA8LS0gd2l0aG91dCBjaGVjayBpdCB3aWxsIHNldCBjYWxsc2l0ZVdpdGhvdXRBd2FpdCA9IG51bGwsIHNvIHdlIHdpbGwgbG9zdCB0cmFja2luZ1xuICAgIF9jcmVhdGVFeHRlbmRlZFByb21pc2UgKHByb21pc2UsIGNhbGxzaXRlKSB7XG4gICAgICAgIGNvbnN0IGV4dGVuZGVkUHJvbWlzZSAgICAgPSBwcm9taXNlLnRoZW4oaWRlbnRpdHkpO1xuICAgICAgICBjb25zdCBtYXJrQ2FsbHNpdGVBd2FpdGVkID0gKCkgPT4gdGhpcy5jYWxsc2l0ZXNXaXRob3V0QXdhaXQuZGVsZXRlKGNhbGxzaXRlKTtcblxuICAgICAgICBleHRlbmRlZFByb21pc2UudGhlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG1hcmtDYWxsc2l0ZUF3YWl0ZWQoKTtcblxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVGhlbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGRlbGVnYXRlQVBJKGV4dGVuZGVkUHJvbWlzZSwgVGVzdENvbnRyb2xsZXIuQVBJX0xJU1QsIHtcbiAgICAgICAgICAgIGhhbmRsZXI6ICAgICB0aGlzLFxuICAgICAgICAgICAgcHJveHlNZXRob2Q6IG1hcmtDYWxsc2l0ZUF3YWl0ZWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGV4dGVuZGVkUHJvbWlzZTtcbiAgICB9XG5cbiAgICBfZW5xdWV1ZVRhc2sgKGFwaU1ldGhvZE5hbWUsIGNyZWF0ZVRhc2tFeGVjdXRvcikge1xuICAgICAgICBjb25zdCBjYWxsc2l0ZSA9IGdldENhbGxzaXRlRm9yTWV0aG9kKGFwaU1ldGhvZE5hbWUpO1xuICAgICAgICBjb25zdCBleGVjdXRvciA9IGNyZWF0ZVRhc2tFeGVjdXRvcihjYWxsc2l0ZSk7XG5cbiAgICAgICAgdGhpcy5leGVjdXRpb25DaGFpbi50aGVuID0gb3JpZ2luYWxUaGVuO1xuICAgICAgICB0aGlzLmV4ZWN1dGlvbkNoYWluICAgICAgPSB0aGlzLmV4ZWN1dGlvbkNoYWluLnRoZW4oZXhlY3V0b3IpO1xuXG4gICAgICAgIHRoaXMuY2FsbHNpdGVzV2l0aG91dEF3YWl0LmFkZChjYWxsc2l0ZSk7XG5cbiAgICAgICAgdGhpcy5leGVjdXRpb25DaGFpbiA9IHRoaXMuX2NyZWF0ZUV4dGVuZGVkUHJvbWlzZSh0aGlzLmV4ZWN1dGlvbkNoYWluLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0aW9uQ2hhaW47XG4gICAgfVxuXG4gICAgX2VucXVldWVDb21tYW5kIChhcGlNZXRob2ROYW1lLCBDbWRDdG9yLCBjbWRBcmdzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlVGFzayhhcGlNZXRob2ROYW1lLCBjYWxsc2l0ZSA9PiB7XG4gICAgICAgICAgICBsZXQgY29tbWFuZCA9IG51bGw7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29tbWFuZCA9IG5ldyBDbWRDdG9yKGNtZEFyZ3MsIHRoaXMudGVzdFJ1bik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgZXJyLmNhbGxzaXRlID0gY2FsbHNpdGU7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy50ZXN0UnVuLnJlY29yZFNjcmVlbkNhcHR1cmUgJiYgYXBpTWV0aG9kTmFtZSAhPT0gJ3Rha2VTY3JlZW5zaG90Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiB0aGlzLnRlc3RSdW4uZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCwgY2FsbHNpdGUpLnRoZW4oIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGVzdFJ1bi5yZWNvcmRTY3JlZW5DYXB0dXJlICYmIGFwaU1ldGhvZE5hbWUgIT09ICd0YWtlU2NyZWVuc2hvdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZUZvbGRlciA9IGAke2RhdGUuZ2V0TW9udGgoKSArIDF9XyR7ZGF0ZS5nZXREYXRlKCl9XyR7ZGF0ZS5nZXRGdWxsWWVhcigpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSB0aGlzLnRlc3RSdW4uc2Vzc2lvbi5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlc3ROYW1lID0gdGhpcy50ZXN0UnVuLnRlc3QubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGggPSBgJHtkYXRlRm9sZGVyfS8ke3Nlc3Npb25JZH0vJHtEYXRlLm5vdygpfV8ke3Rlc3ROYW1lfV8ke2FwaU1ldGhvZE5hbWV9X2F1dG8ucG5nYDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy50ZXN0UnVuLmV4ZWN1dGVDb21tYW5kKG5ldyBUYWtlU2NyZWVuc2hvdENvbW1hbmQoeyBwYXRoOiBwYXRoIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy50ZXN0UnVuLmV4ZWN1dGVDb21tYW5kKGNvbW1hbmQsIGNhbGxzaXRlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQVBJIGltcGxlbWVudGF0aW9uXG4gICAgLy8gV2UgbmVlZCBpbXBsZW1lbnRhdGlvbiBtZXRob2RzIHRvIG9idGFpbiBjb3JyZWN0IGNhbGxzaXRlcy4gSWYgd2UgdXNlIHBsYWluIEFQSVxuICAgIC8vIG1ldGhvZHMgaW4gY2hhaW5lZCB3cmFwcGVycyB0aGVuIHdlIHdpbGwgaGF2ZSBjYWxsc2l0ZSBmb3IgdGhlIHdyYXBwZWQgbWV0aG9kXG4gICAgLy8gaW4gdGhpcyBmaWxlIGluc3RlYWQgb2YgY2hhaW5lZCBtZXRob2QgY2FsbHNpdGUgaW4gdXNlciBjb2RlLlxuICAgIF9jdHgkZ2V0dGVyICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGVzdFJ1bi5jdHg7XG4gICAgfVxuXG4gICAgX2N0eCRzZXR0ZXIgKHZhbCkge1xuICAgICAgICB0aGlzLnRlc3RSdW4uY3R4ID0gdmFsO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnRlc3RSdW4uY3R4O1xuICAgIH1cblxuICAgIF9maXh0dXJlQ3R4JGdldHRlciAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRlc3RSdW4uZml4dHVyZUN0eDtcbiAgICB9XG5cbiAgICBfY2xpY2skIChzZWxlY3Rvciwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ2NsaWNrJywgQ2xpY2tDb21tYW5kLCB7IHNlbGVjdG9yLCBvcHRpb25zIH0pO1xuICAgIH1cblxuICAgIF9yaWdodENsaWNrJCAoc2VsZWN0b3IsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCdyaWdodENsaWNrJywgUmlnaHRDbGlja0NvbW1hbmQsIHsgc2VsZWN0b3IsIG9wdGlvbnMgfSk7XG4gICAgfVxuXG4gICAgX2RvdWJsZUNsaWNrJCAoc2VsZWN0b3IsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCdkb3VibGVDbGljaycsIERvdWJsZUNsaWNrQ29tbWFuZCwgeyBzZWxlY3Rvciwgb3B0aW9ucyB9KTtcbiAgICB9XG5cbiAgICBfaG92ZXIkIChzZWxlY3Rvciwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ2hvdmVyJywgSG92ZXJDb21tYW5kLCB7IHNlbGVjdG9yLCBvcHRpb25zIH0pO1xuICAgIH1cblxuICAgIF9kcmFnJCAoc2VsZWN0b3IsIGRyYWdPZmZzZXRYLCBkcmFnT2Zmc2V0WSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ2RyYWcnLCBEcmFnQ29tbWFuZCwgeyBzZWxlY3RvciwgZHJhZ09mZnNldFgsIGRyYWdPZmZzZXRZLCBvcHRpb25zIH0pO1xuICAgIH1cblxuICAgIF9kcmFnVG9FbGVtZW50JCAoc2VsZWN0b3IsIGRlc3RpbmF0aW9uU2VsZWN0b3IsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCdkcmFnVG9FbGVtZW50JywgRHJhZ1RvRWxlbWVudENvbW1hbmQsIHsgc2VsZWN0b3IsIGRlc3RpbmF0aW9uU2VsZWN0b3IsIG9wdGlvbnMgfSk7XG4gICAgfVxuXG4gICAgX3R5cGVUZXh0JCAoc2VsZWN0b3IsIHRleHQsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCd0eXBlVGV4dCcsIFR5cGVUZXh0Q29tbWFuZCwgeyBzZWxlY3RvciwgdGV4dCwgb3B0aW9ucyB9KTtcbiAgICB9XG5cbiAgICBfc2VsZWN0VGV4dCQgKHNlbGVjdG9yLCBzdGFydFBvcywgZW5kUG9zLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZCgnc2VsZWN0VGV4dCcsIFNlbGVjdFRleHRDb21tYW5kLCB7IHNlbGVjdG9yLCBzdGFydFBvcywgZW5kUG9zLCBvcHRpb25zIH0pO1xuICAgIH1cblxuICAgIF9zZWxlY3RUZXh0QXJlYUNvbnRlbnQkIChzZWxlY3Rvciwgc3RhcnRMaW5lLCBzdGFydFBvcywgZW5kTGluZSwgZW5kUG9zLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZCgnc2VsZWN0VGV4dEFyZWFDb250ZW50JywgU2VsZWN0VGV4dEFyZWFDb250ZW50Q29tbWFuZCwge1xuICAgICAgICAgICAgc2VsZWN0b3IsXG4gICAgICAgICAgICBzdGFydExpbmUsXG4gICAgICAgICAgICBzdGFydFBvcyxcbiAgICAgICAgICAgIGVuZExpbmUsXG4gICAgICAgICAgICBlbmRQb3MsXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9zZWxlY3RFZGl0YWJsZUNvbnRlbnQkIChzdGFydFNlbGVjdG9yLCBlbmRTZWxlY3Rvciwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ3NlbGVjdEVkaXRhYmxlQ29udGVudCcsIFNlbGVjdEVkaXRhYmxlQ29udGVudENvbW1hbmQsIHtcbiAgICAgICAgICAgIHN0YXJ0U2VsZWN0b3IsXG4gICAgICAgICAgICBlbmRTZWxlY3RvcixcbiAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX3ByZXNzS2V5JCAoa2V5cywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ3ByZXNzS2V5JywgUHJlc3NLZXlDb21tYW5kLCB7IGtleXMsIG9wdGlvbnMgfSk7XG4gICAgfVxuXG4gICAgX3dhaXQkICh0aW1lb3V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZCgnd2FpdCcsIFdhaXRDb21tYW5kLCB7IHRpbWVvdXQgfSk7XG4gICAgfVxuXG4gICAgX25hdmlnYXRlVG8kICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCduYXZpZ2F0ZVRvJywgTmF2aWdhdGVUb0NvbW1hbmQsIHsgdXJsIH0pO1xuICAgIH1cblxuICAgIF9zZXRGaWxlc1RvVXBsb2FkJCAoc2VsZWN0b3IsIGZpbGVQYXRoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZCgnc2V0RmlsZXNUb1VwbG9hZCcsIFNldEZpbGVzVG9VcGxvYWRDb21tYW5kLCB7IHNlbGVjdG9yLCBmaWxlUGF0aCB9KTtcbiAgICB9XG5cbiAgICBfY2xlYXJVcGxvYWQkIChzZWxlY3Rvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ2NsZWFyVXBsb2FkJywgQ2xlYXJVcGxvYWRDb21tYW5kLCB7IHNlbGVjdG9yIH0pO1xuICAgIH1cblxuICAgIF90YWtlU2NyZWVuc2hvdCQgKHBhdGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCd0YWtlU2NyZWVuc2hvdCcsIFRha2VTY3JlZW5zaG90Q29tbWFuZCwgeyBwYXRoIH0pO1xuICAgIH1cblxuICAgIF90YWtlRWxlbWVudFNjcmVlbnNob3QkIChzZWxlY3RvciwgLi4uYXJncykge1xuICAgICAgICBjb25zdCBjb21tYW5kQXJncyA9IHsgc2VsZWN0b3IgfTtcblxuICAgICAgICBpZiAoYXJnc1sxXSkge1xuICAgICAgICAgICAgY29tbWFuZEFyZ3MucGF0aCAgICA9IGFyZ3NbMF07XG4gICAgICAgICAgICBjb21tYW5kQXJncy5vcHRpb25zID0gYXJnc1sxXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ29iamVjdCcpXG4gICAgICAgICAgICBjb21tYW5kQXJncy5vcHRpb25zID0gYXJnc1swXTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY29tbWFuZEFyZ3MucGF0aCA9IGFyZ3NbMF07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCd0YWtlRWxlbWVudFNjcmVlbnNob3QnLCBUYWtlRWxlbWVudFNjcmVlbnNob3RDb21tYW5kLCBjb21tYW5kQXJncyk7XG4gICAgfVxuXG4gICAgX3Jlc2l6ZVdpbmRvdyQgKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCdyZXNpemVXaW5kb3cnLCBSZXNpemVXaW5kb3dDb21tYW5kLCB7IHdpZHRoLCBoZWlnaHQgfSk7XG4gICAgfVxuXG4gICAgX3Jlc2l6ZVdpbmRvd1RvRml0RGV2aWNlJCAoZGV2aWNlLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZCgncmVzaXplV2luZG93VG9GaXREZXZpY2UnLCBSZXNpemVXaW5kb3dUb0ZpdERldmljZUNvbW1hbmQsIHsgZGV2aWNlLCBvcHRpb25zIH0pO1xuICAgIH1cblxuICAgIF9tYXhpbWl6ZVdpbmRvdyQgKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ21heGltaXplV2luZG93JywgTWF4aW1pemVXaW5kb3dDb21tYW5kKTtcbiAgICB9XG5cbiAgICBfc3dpdGNoVG9JZnJhbWUkIChzZWxlY3Rvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ3N3aXRjaFRvSWZyYW1lJywgU3dpdGNoVG9JZnJhbWVDb21tYW5kLCB7IHNlbGVjdG9yIH0pO1xuICAgIH1cblxuICAgIF9zd2l0Y2hUb01haW5XaW5kb3ckICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCdzd2l0Y2hUb01haW5XaW5kb3cnLCBTd2l0Y2hUb01haW5XaW5kb3dDb21tYW5kKTtcbiAgICB9XG5cbiAgICBfZXZhbCQgKGZuLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQob3B0aW9ucykpXG4gICAgICAgICAgICBvcHRpb25zID0gYXNzaWduKHt9LCBvcHRpb25zLCB7IGJvdW5kVGVzdFJ1bjogdGhpcyB9KTtcblxuICAgICAgICBjb25zdCBidWlsZGVyICA9IG5ldyBDbGllbnRGdW5jdGlvbkJ1aWxkZXIoZm4sIG9wdGlvbnMsIHsgaW5zdGFudGlhdGlvbjogJ2V2YWwnLCBleGVjdXRpb246ICdldmFsJyB9KTtcbiAgICAgICAgY29uc3QgY2xpZW50Rm4gPSBidWlsZGVyLmdldEZ1bmN0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGNsaWVudEZuKCk7XG4gICAgfVxuXG4gICAgX3NldE5hdGl2ZURpYWxvZ0hhbmRsZXIkIChmbiwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ3NldE5hdGl2ZURpYWxvZ0hhbmRsZXInLCBTZXROYXRpdmVEaWFsb2dIYW5kbGVyQ29tbWFuZCwge1xuICAgICAgICAgICAgZGlhbG9nSGFuZGxlcjogeyBmbiwgb3B0aW9ucyB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9nZXROYXRpdmVEaWFsb2dIaXN0b3J5JCAoKSB7XG4gICAgICAgIGNvbnN0IGNhbGxzaXRlID0gZ2V0Q2FsbHNpdGVGb3JNZXRob2QoJ2dldE5hdGl2ZURpYWxvZ0hpc3RvcnknKTtcblxuICAgICAgICByZXR1cm4gdGhpcy50ZXN0UnVuLmV4ZWN1dGVDb21tYW5kKG5ldyBHZXROYXRpdmVEaWFsb2dIaXN0b3J5Q29tbWFuZCgpLCBjYWxsc2l0ZSk7XG4gICAgfVxuXG4gICAgX2dldEJyb3dzZXJDb25zb2xlTWVzc2FnZXMkICgpIHtcbiAgICAgICAgY29uc3QgY2FsbHNpdGUgPSBnZXRDYWxsc2l0ZUZvck1ldGhvZCgnZ2V0QnJvd3NlckNvbnNvbGVNZXNzYWdlcycpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnRlc3RSdW4uZXhlY3V0ZUNvbW1hbmQobmV3IEdldEJyb3dzZXJDb25zb2xlTWVzc2FnZXNDb21tYW5kKCksIGNhbGxzaXRlKTtcbiAgICB9XG5cbiAgICBfZXhwZWN0JCAoYWN0dWFsKSB7XG4gICAgICAgIGNvbnN0IGNhbGxzaXRlID0gZ2V0Q2FsbHNpdGVGb3JNZXRob2QoJ2V4cGVjdCcpO1xuXG4gICAgICAgIHJldHVybiBuZXcgQXNzZXJ0aW9uKGFjdHVhbCwgdGhpcywgY2FsbHNpdGUpO1xuICAgIH1cblxuICAgIF9kZWJ1ZyQgKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ2RlYnVnJywgRGVidWdDb21tYW5kKTtcbiAgICB9XG5cbiAgICBfc2V0VGVzdFNwZWVkJCAoc3BlZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKCdzZXRUZXN0U3BlZWQnLCBTZXRUZXN0U3BlZWRDb21tYW5kLCB7IHNwZWVkIH0pO1xuICAgIH1cblxuICAgIF9zZXRQYWdlTG9hZFRpbWVvdXQkIChkdXJhdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZUNvbW1hbmQoJ3NldFBhZ2VMb2FkVGltZW91dCcsIFNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQsIHsgZHVyYXRpb24gfSk7XG4gICAgfVxuXG4gICAgX3VzZVJvbGUkIChyb2xlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZCgndXNlUm9sZScsIFVzZVJvbGVDb21tYW5kLCB7IHJvbGUgfSk7XG4gICAgfVxuXG4gICAgX2FkZFJlcXVlc3RIb29rcyQgKC4uLmhvb2tzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlVGFzaygnYWRkUmVxdWVzdEhvb2tzJywgKCkgPT4ge1xuICAgICAgICAgICAgaG9va3MgPSBmbGF0dGVuKGhvb2tzKTtcblxuICAgICAgICAgICAgYXNzZXJ0UmVxdWVzdEhvb2tUeXBlKGhvb2tzKTtcblxuICAgICAgICAgICAgaG9va3MuZm9yRWFjaChob29rID0+IHRoaXMudGVzdFJ1bi5hZGRSZXF1ZXN0SG9vayhob29rKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9yZW1vdmVSZXF1ZXN0SG9va3MkICguLi5ob29rcykge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5xdWV1ZVRhc2soJ3JlbW92ZVJlcXVlc3RIb29rcycsICgpID0+IHtcbiAgICAgICAgICAgIGhvb2tzID0gZmxhdHRlbihob29rcyk7XG5cbiAgICAgICAgICAgIGFzc2VydFJlcXVlc3RIb29rVHlwZShob29rcyk7XG5cbiAgICAgICAgICAgIGhvb2tzLmZvckVhY2goaG9vayA9PiB0aGlzLnRlc3RSdW4ucmVtb3ZlUmVxdWVzdEhvb2soaG9vaykpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cblRlc3RDb250cm9sbGVyLkFQSV9MSVNUID0gZ2V0RGVsZWdhdGVkQVBJTGlzdChUZXN0Q29udHJvbGxlci5wcm90b3R5cGUpO1xuXG5kZWxlZ2F0ZUFQSShUZXN0Q29udHJvbGxlci5wcm90b3R5cGUsIFRlc3RDb250cm9sbGVyLkFQSV9MSVNULCB7IHVzZUN1cnJlbnRDdHhBc0hhbmRsZXI6IHRydWUgfSk7XG4iXX0=
